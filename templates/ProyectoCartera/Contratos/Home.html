{% extends "ProyectoCartera/base.html" %}
{% load static %}

{% block title %}Home{% endblock %}

{% block body %}
    {% if messages %}
        {% for mensaje in messages %}
            <script>
                Swal.fire({
                    "title" : "{{ mensaje }}",
                    "icon" : "success"
                })
            </script>
        {% endfor %}
    {% endif %}

    <div class="table-responsive m-5">
         <table id="example" class="display nowrap" ></table>
    </div>
     <div class="row m-5" >
        <a href="{% url 'agregar_contrato' %}" class="btn btn-primary"> Agregar Contrato </a>
    </div>

    <script>
        $('#example').DataTable({
            responsive: true,
            language: {
                "url": "//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json"
            },
            columns: [
                { title: 'Contrato' },
                { title: 'Asesor' },
                { title: 'Cliente' },
                { title: 'Valor.' },
                { title: 'Descripcion' },
                { title: 'Fecha Inicial' },
                { title: 'Fecha Final' },
                {
                    title: 'Archivo',
                    render: function (data, type, row, meta){
                         return '<a href="media/' + row[7] + '" target="_blank"><img src="{% static 'img/filetype-pdf.svg' %}" class="bi d-block mx-auto mb-1" width="24" height="24"></a>';

                    }
                },
                {
                    title: 'Acciones',
                    render: function (data, type, row, meta) {
                        return '<button class="btn btn-info" onclick="editarContrato(' + row[0] +')">Editar</button> ' +
                            ' <button class="btn btn-success" onclick="vista_pago(' + row[0] +')">Pagos</button>';
                    }
                }
            ],
            data: {{ Contratos|safe }}
        });
        function editarContrato(contratoId) {
            window.location.href = "/editarContratoVista/" + contratoId.toString()
        }
        function vista_pago(contratoId){
            window.location.href = "/Pagos/" + contratoId.toString()
        }
    </script>
{% endblock %}